<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Spotify Clone</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="./Assets/CSS/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
</head>



<body>

    <!-- navigation -->
    <ul class="nav justify-content-space-between p-3">
        <li class="nav-item">
            <img src="./Images/spotify.svg" width="10%" alt="">
        </li>

        <li class="nav-item" style="width: 400px;">
            <form class="d-flex" role="search">
                <i class="fa-solid fa-house fa-2x bg-dark text-light me-2 rounded-circle"></i>
                <input class="form-control rounded-pill" type="search" placeholder="Search" aria-label="Search">

            </form>
        </li>




        <li class="nav-item">
            <button class="btn btn-light rounded-pill">Expolore Premium</button>
        </li>
    </ul>






    <div class="container-fluid">
        <div class="row  justify-content-center">
            <!-- Sound List -->
            <div class="col-md-3 sound-list rounded me-2 pt-5">




            </div>

            <!-- Main Sounds -->
            <div class="col-md-8 main-sound rounded p-4">
                <div class="row Albums">

                    <div class="col-md-4">
                        <div class="card AlbumCard ">
                            <img src="./Images/2.jpg" class="card-img-top albumImage" alt="...">
                            <div class="card-body">
                                <h5 class="card-title albumTitle text-light display-6">NCS</h5>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="card AlbumCard ">
                            <img src="./Images/3.jpg" class="card-img-top albumImage" alt="...">
                            <div class="card-body">
                                <h5 class="card-title albumTitle text-light display-6">CVRTOON</h5>
                            </div>
                        </div>
                    </div>







                </div>

                <div class="player">
                    <div class="songDiv">
                        <h6 class="songName">Song Name</h6>
                    </div>
                    <div class="SongButtons">
                        <i class="fa-solid fa-backward"></i>
                        <i class="fa-solid fa-play" id="play"></i>
                        <i class="fa-solid fa-forward"></i>
                    </div>
                    <div class="songsDuration">
                        <h6 class="Duration">00:00/00:00</h6>
                    </div>
                </div>
                <div class="progress">
                    <div class="progress-bar " role="progressbar" aria-label="Success example" style="width: 0%"
                        aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>

        </div>


    </div>







    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>

    <script>
        let currentSong = new Audio();
        let currentSongIndex = 0;
        const SongsArray = [];

        document.querySelectorAll('.AlbumCard').forEach(elem => {
            elem.addEventListener("click", async (e) => {
                SongsArray.splice(0); // Clear the current SongsArray
                AlbumPlaylist = elem.querySelector('.albumTitle').innerHTML; // Update album name
                currentSongIndex = 0; // Reset current song index
                await PlaySongs(AlbumPlaylist); // Reload songs from the new album

            })
        })



        function secondsToMinutesSeconds(seconds) {
            if (isNaN(seconds) || seconds < 0) {
                return "00:00";
            }

            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);

            const formattedMinutes = String(minutes).padStart(2, '0');
            const formattedSeconds = String(remainingSeconds).padStart(2, '0');

            return `${formattedMinutes}:${formattedSeconds}`;
        }






        const PlayButton = (song) => {
            currentSong.src = `/Songs/${AlbumPlaylist}/` + song;
            play.classList.replace("fa-play", "fa-pause")
            document.querySelector(".songName").innerHTML = song
            document.querySelector(".Duration").innerHTML = "00:00"
            currentSong.play();
        }


        const API_CALL = async (folder) => {

            const response = await fetch(`http://127.0.0.1:5500/Songs/${folder == undefined ? "NCS" : folder}/`);
            const data = await response.text();
            const div = document.createElement("li");
            div.innerHTML = data;

            const links = div.getElementsByTagName('a');
            SongsArray.splice(0)
            for (let index = 0; index < links.length; index++) {
                const element = links[index];
                if (element.href.endsWith('.mp3')) {
                    SongsArray.push(element.getElementsByClassName('name')[0].innerHTML);
                }

            }



            return SongsArray
        }







        const PlaySongs = async (folder) => {
            let html = '';
            const allsongs = await API_CALL(folder);
            // GetFolder("NCS")
            SongsArray.forEach(elem => {
                html += `<div class="d-flex flex-row mb-3 soundlist rounded pt-3 px-3 ">
                         <i class="fa-solid fa-music fa-2x text-light"></i>
                         <div class="flex-grow-1 artisit-info ms-3">
                         <h5 class="text-light MusicName">${String(elem).replace(".mp3", "")}</h5>
                         <p class="text-light">${elem}</p>
                         </div>
                     
                         </div>`;
            });

            document.querySelector(".sound-list").innerHTML = html;

            document.querySelectorAll('.artisit-info').forEach(elem => {
                elem.addEventListener("click", (e) => {
                    const songUrl = elem.children[1].innerHTML;
                    PlayButton(songUrl)



                })
            })

            play.addEventListener('click', (e) => {

                if (currentSong.paused && e.target.classList.contains('fa-play')) {
                    currentSong.play()
                    e.target.classList.replace("fa-play", "fa-pause")


                } else {
                    e.target.classList.replace("fa-pause", "fa-play")
                    currentSong.pause()
                }
            })

            currentSong.addEventListener("timeupdate", (e) => {
                document.querySelector('.progress-bar').style.width = `${currentSong.currentTime / currentSong.duration * 100}%`
                document.querySelector('.Duration').innerHTML = `${secondsToMinutesSeconds(currentSong.currentTime)} / ${secondsToMinutesSeconds(currentSong.duration)}`
            })

            // Add an event listener to seekbar
            document.querySelector(".progress").addEventListener("click", e => {
                let percent = (e.offsetX / e.target.getBoundingClientRect().width) * 100;
                document.querySelector(".progress-bar").style.width = percent + "%";
                currentSong.currentTime = ((currentSong.duration) * percent) / 100
            })


            // Next Song
            document.querySelector(".fa-forward").addEventListener("click", (e) => {
                if (currentSongIndex < SongsArray.length - 1) {
                    currentSongIndex++
                    PlayButton(SongsArray[currentSongIndex]);
                }

            })


            // Previous Song
            document.querySelector(".fa-backward").addEventListener("click", (e) => {
                // Find the current song index
                if (currentSongIndex <= SongsArray.length) {
                    currentSongIndex--
                    PlayButton(SongsArray[currentSongIndex]);

                } if (currentSongIndex <= 0) {
                    currentSongIndex = 0
                    PlayButton(SongsArray[currentSongIndex]);
                }



            })





        };



        PlaySongs()




    </script>
</body>

</html>